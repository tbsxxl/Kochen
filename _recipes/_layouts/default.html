<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}</title>
  <meta name="theme-color" content="#f6f7f9">

  <!-- Wichtig: relative_url sorgt dafür, dass es mit baseurl funktioniert -->
  <link rel="stylesheet" href="{{ '/assets/styles.css?v=20260220_5' | relative_url }}">
  <script defer src="{{ '/assets/utils.js?v=20260220_5' | relative_url }}"></script>
</head>
<body class="{% if page.layout == 'recipe' %}isRecipe{% endif %}">
  <!-- iPhone-friendly Topbar: minimal -->
  <header class="iosTopbar">
    <div class="container iosTopbarInner">
      <button class="navIconBtn" id="backBtn" aria-label="Zurück">‹</button>

      <div class="iosTopTitleWrap">
        <div class="iosTopTitle">
          {% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}
        </div>
        <div class="iosTopSub">{% if page.title %}{{ site.title }}{% else %}{{ site.description }}{% endif %}</div>
      </div>

      <a class="navIconBtn" href="{{ '/rezeptindex/' | relative_url }}" aria-label="Suche"
         style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center"><svg class="iconSvg" viewBox="0 0 24 24" aria-hidden="true"><path d="M10.5 3a7.5 7.5 0 1 0 4.8 13.3l4.45 4.45a1 1 0 0 0 1.42-1.42l-4.45-4.45A7.5 7.5 0 0 0 10.5 3zm0 2a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11z"/></svg></a>
    </div>
  </header>

  <main class="container appMain">
    {{ content }}
  </main>

  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- Bottom Tabbar -->
  {% unless page.layout == "recipe" %}
<nav class="tabbar" aria-label="Navigation">
  <div class="tabbarInner container">
    <a class="tabItem" data-tab href="{{ '/' | relative_url }}">
      <span class="tabIcon"><svg class="iconSvg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3.2 3 10.6v9.2a1.2 1.2 0 0 0 1.2 1.2h5.1v-6.6h5.4V21h5.1A1.2 1.2 0 0 0 21 19.8v-9.2L12 3.2zm7 16.6h-3.1v-6.6H8.1v6.6H5v-8.5l7-5.7 7 5.7v8.5z"/></svg></span><span class="tabLabel">Start</span>
    </a>

    <a class="tabItem" data-tab href="{{ '/rezeptindex/' | relative_url }}">
      <span class="tabIcon"><svg class="iconSvg" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 3h10a2 2 0 0 1 2 2v16l-3-2-3 2-3-2-3 2-3-2V5a2 2 0 0 1 2-2zm0 2v13.2l1 .7 3-2 3 2 3-2 1 .7V5H7zm2 2h6v2H9V7zm0 4h6v2H9v-2z"/></svg></span><span class="tabLabel">Rezepte</span>
    </a>

    <a class="tabItem" data-tab href="{{ '/shopping/' | relative_url }}">
      <span class="tabIcon"><svg class="iconSvg" viewBox="0 0 24 24" aria-hidden="true"><path d="M6.5 6h14l-1.3 7.2a2 2 0 0 1-2 1.6H9a2 2 0 0 1-2-1.6L5.3 4H3V2h3.1a1 1 0 0 1 1 .8L7.3 6zM9 18a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm10 2a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8.9 12.8h8.2l.9-4.8H8l.9 4.8z"/></svg></span><span class="tabLabel">Liste</span>
    </a>

    <button class="tabItem tabMore" id="moreBtn" aria-label="Mehr" type="button">
      <span class="tabIcon"><svg class="iconSvg" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 10.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm7 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm7 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3z"/></svg></span><span class="tabLabel">Mehr</span>
    </button>
  </div>
</nav>
{% endunless %}

  <!-- Bottom Sheet: Mehr -->
  <div class="sheetOverlay" id="sheetOverlay"></div>
  <section class="sheet" id="sheet" aria-label="Mehr-Menü" aria-hidden="true">
    <div class="sheetGrab"></div>
    <div class="sheetHead">
      <div class="sheetTitle">Mehr</div>
      <button class="navIconBtn" id="sheetClose" aria-label="Schließen" type="button">✕</button>
    </div>

    <div class="sheetBody">
      <a class="sheetRow" href="{{ '/admin/' | relative_url }}">⚙︎ Admin</a>
      <a class="sheetRow" href="{{ '/backup/' | relative_url }}">⬇︎ Backup / Import</a>
      <div class="sheetSep"></div>
      <button class="sheetRow" id="toggleCompact" type="button">↕︎ Compact Mode</button>
      <button class="sheetRow" id="toggleContrast" type="button">◐ High Contrast</button>
    </div>
  </section>

  <script>
  (function(){
    // Back Button
    const backBtn = document.getElementById('backBtn');
    if (history.length > 1) backBtn.addEventListener('click', ()=>history.back());
    else backBtn.style.visibility = 'hidden';

    // Active Tab Highlight
    const path = location.pathname.replace(/\/+$/,'') || "/";
    const recipeBase = "{{ '/rezepte/' | relative_url }}".replace(/\/+$/,'');
    const recipeIndex = "{{ '/rezeptindex/' | relative_url }}".replace(/\/+$/,'');

    document.querySelectorAll('[data-tab]').forEach(a=>{
      const href = new URL(a.getAttribute('href'), location.origin).pathname.replace(/\/+$/,'') || "/";
      if (href === path) a.classList.add('active');
      if (recipeBase && path.startsWith(recipeBase) && href === recipeIndex) a.classList.add('active');
    });

    // Sheet open/close
    const moreBtn = document.getElementById('moreBtn');
    const overlay = document.getElementById('sheetOverlay');
    const sheet = document.getElementById('sheet');
    const closeBtn = document.getElementById('sheetClose');

    function openSheet(){ overlay.classList.add('open'); sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false'); }
    function closeSheet(){ overlay.classList.remove('open'); sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); }

    moreBtn.addEventListener('click', openSheet);
    overlay.addEventListener('click', closeSheet);
    closeBtn.addEventListener('click', closeSheet);

    // Persisted toggles
    const get = (k,fb)=>{ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):fb; }catch{return fb;} };
    const set = (k,v)=>{ try{ localStorage.setItem(k,JSON.stringify(v)); }catch{} };

    const compactKey="kochbuch.ui.compact";
    const contrastKey="kochbuch.ui.contrast";

    function apply(){
      document.body.classList.toggle('compact', !!get(compactKey,false));
      document.body.classList.toggle('highContrast', !!get(contrastKey,false));
    }
    apply();

    document.getElementById('toggleCompact').addEventListener('click', ()=>{ set(compactKey,!get(compactKey,false)); apply(); });
    document.getElementById('toggleContrast').addEventListener('click', ()=>{ set(contrastKey,!get(contrastKey,false)); apply(); });
  })();
  </script>
</body>
</html>
