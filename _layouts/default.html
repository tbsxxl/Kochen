<script>
  window.RECIPE_DATA = {
    id: "{{ page.url | relative_url }}",
    title: {{ page.title | jsonify }},
    baseServings: {{ page.servings | default: 1 }},
    ingredients: {{ page.ingredients | jsonify }}
  };
</script>

<div class="section">
  <div class="card cardPad">
    <div class="recipeHeader">
      <div class="h1" style="margin:0">{{ page.title }}</div>

      {% if page.image %}
        <div class="recipeHero">
          <img class="recipeHeroImg" src="{{ page.image | relative_url }}" alt="{{ page.title | escape }}">
        </div>
      {% endif %}

      <div class="kvRow">
        {% if page.category %}<span class="kv">ğŸ· {{ page.category }}</span>{% endif %}
        {% if page.time %}<span class="kv">â± {{ page.time }}</span>{% endif %}
        {% if page.servings %}<span class="kv">ğŸ½ {{ page.servings }}</span>{% endif %}
        {% if page.date %}<span class="kv">ğŸ“… {{ page.date | date: "%d.%m.%Y" }}</span>{% endif %}
      </div>

      {% if page.tags %}
      <div class="chips">
        {% for t in page.tags %}
          <span class="chip">{{ t }}</span>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <div class="hr"></div>

    <!-- Stats small line (moved up, actions moved down) -->
    <div class="dim" id="statsLine"></div>

    <div class="hr"></div>

    <!-- Portionen + Zutaten -->
    <div class="card cardPad recipeInnerCard" style="box-shadow:none;border:1px solid rgba(15,23,42,.10)">
      <div class="searchRow" style="padding:0">
        <div style="flex:1">
          <div class="sub" style="margin-bottom:6px">Portionen</div>
          <input id="servingsInput" inputmode="numeric" style="width:100%" />
          <div class="dim" style="margin-top:6px">Basis: <span id="baseServings"></span></div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="h2" style="margin:0 0 8px 0">Zutaten</div>
      <div id="ingredientsList"></div>
    </div>

    <div class="hr"></div>

    <div class="recipeBody">
      {{ content }}
    </div>

    <div class="hr"></div>

    <div class="footerRow">
      <a class="btn" href="{{ '/rezeptindex/' | relative_url }}" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;flex:1">â† Alle Rezepte</a>
      <a class="btn" href="{{ '/shopping/' | relative_url }}" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;flex:1">ğŸ›’ Shopping List</a>
    </div>
  </div>
</div>

<!-- Sticky Bottom Action Bar (iPhone thumb area) -->
<div class="recipeBar">
  <div class="recipeBarInner">
    <button class="rbarBtn" id="cookedBtn" aria-label="Gekocht">
      <span class="rbarIcon">âœ…</span><span class="rbarTxt">Gekocht</span>
    </button>

    <button class="rbarBtn" id="favoriteBtn" aria-label="Favorit">
      <span class="rbarIcon">â˜†</span><span class="rbarTxt">Favorit</span>
    </button>

    <button class="rbarBtn rbarPrimary" id="addToShopping" aria-label="Zur Liste">
      <span class="rbarIcon">ğŸ›’</span><span class="rbarTxt">Zur Liste</span>
    </button>

    <button class="rbarBtn" id="freezerBtn" aria-label="KÃ¼hltruhe">
      <span class="rbarIcon">ğŸ§Š</span><span class="rbarTxt">Freezer</span>
    </button>

    <button class="rbarBtn rbarMore" id="recipeMoreBtn" aria-label="Mehr">
      <span class="rbarIcon">â‹¯</span><span class="rbarTxt">Mehr</span>
    </button>
  </div>
</div>

<!-- Recipe More Sheet (Undo/Print etc.) -->
<div class="sheetOverlay" id="recipeSheetOverlay"></div>
<section class="sheet" id="recipeSheet" aria-label="Rezept-MenÃ¼" aria-hidden="true">
  <div class="sheetGrab"></div>
  <div class="sheetHead">
    <div class="sheetTitle">Rezept</div>
    <button class="navIconBtn" id="recipeSheetClose" aria-label="SchlieÃŸen">âœ•</button>
  </div>

  <div class="sheetBody">
    <button class="sheetRow" id="undoCookedBtn">â†©ï¸ Undo â€Gekochtâ€œ</button>
    <button class="sheetRow" onclick="window.print()">ğŸ–¨ Drucken</button>
  </div>
</section>

<script src="{{ '/assets/recipe.js' | relative_url }}"></script>

<script>
(function(){
  const moreBtn = document.getElementById('recipeMoreBtn');
  const overlay = document.getElementById('recipeSheetOverlay');
  const sheet = document.getElementById('recipeSheet');
  const closeBtn = document.getElementById('recipeSheetClose');

  if(!moreBtn || !overlay || !sheet || !closeBtn) return;

  function openSheet(){
    overlay.classList.add('open');
    sheet.classList.add('open');
    sheet.setAttribute('aria-hidden','false');
  }
  function closeSheet(){
    overlay.classList.remove('open');
    sheet.classList.remove('open');
    sheet.setAttribute('aria-hidden','true');
  }
  moreBtn.addEventListener('click', openSheet);
  overlay.addEventListener('click', closeSheet);
  closeBtn.addEventListener('click', closeSheet);
})();
</script>
