---
layout: default
---

{% assign newest = site.recipes | sort: "date" | reverse %}
{% assign featured = newest | first %}

<main class="page homePage">

  <h1 class="page-title">Heute</h1>

  <!-- Hero Card (t√§gliche Auswahl wird per JS gesetzt; featured ist Fallback) -->
  <a class="linkCard heroLink" id="todayLink" href="{{ featured.url | relative_url }}">
    <article class="hero-card" aria-label="Rezept des Tages">
      <span class="favBadge" id="todayFav" data-fav-badge data-recipe-id="{{ featured.url | relative_url }}" aria-hidden="true">‚òÖ</span>

      <div class="hero-media" id="todayThumbWrap" {% unless featured.image %}style="display:none"{% endunless %}>
        <img
          class="hero-img"
          id="todayImg"
          src="{% if featured.image %}{{ featured.image | relative_url }}{% endif %}"
          alt="{{ featured.title | escape }}"
          loading="lazy"
          decoding="async"
        >
      </div>

      <div class="hero-body">
        <div class="hero-top">
          <h2 class="hero-title" id="todayTitle">{{ featured.title }}</h2>
          <span class="pill pill-accent" id="todayCat" {% unless featured.category %}style="display:none"{% endunless %}>{{ featured.category }}</span>
        </div>

        <div class="hero-meta" id="todayMeta">
          <span id="todayTime" {% unless featured.time %}style="display:none"{% endunless %}>‚è± {{ featured.time }}</span>
          <span id="todayServings" {% unless featured.servings %}style="display:none"{% endunless %}>üçΩ {{ featured.servings }}</span>
        </div>
      </div>
    </article>
  </a>

  <!-- F√ºr dich -->
  <section class="section">
    <div class="section-header">
      <h3 class="section-title">F√ºr dich</h3>
    </div>
    <div class="favorites-scroll hScroll" id="forYouRow" aria-label="Empfehlungen"></div>
  </section>

  <!-- Favoriten -->
  <section class="section">
    <div class="section-header">
      <h3 class="section-title">Favoriten</h3>
      <a class="section-link" href="{{ '/rezeptindex/' | relative_url }}">Alle ‚Üí</a>
    </div>
    <div class="favorites-scroll hScroll" id="favoritesRow" aria-label="Favoriten"></div>
  </section>

  <!-- K√ºhltruhe -->
  <section class="section" id="freezerSection" hidden>
    <div class="section-header">
      <h3 class="section-title">K√ºhltruhe</h3>
      <a class="section-link" href="{{ '/kuehltruhe/' | relative_url }}">Alle ‚Üí</a>
    </div>
    <div class="stack" id="freezerList" aria-label="K√ºhltruhe"></div>
  </section>

</main>

<!-- All recipes payload for JS -->
<script type="application/json" id="allRecipesJson">
[
{% assign sorted2 = site.recipes | sort: "title" %}
{% for r in sorted2 %}
  {
    "id": "{{ r.url | relative_url }}",
    "url": "{{ r.url | relative_url }}",
    "title": {{ r.title | jsonify }},
    "category": {{ r.category | jsonify }},
    "time": {{ r.time | jsonify }},
    "servings": {{ r.servings | jsonify }},
    "tags": {{ r.tags | jsonify }},
    "image": "{% if r.image %}{{ r.image | relative_url }}{% endif %}"
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
]
</script>

<script defer src="{{ '/assets/home-reco.js' | relative_url }}?v={{ site.time | date: '%s' }}"></script>

<!-- Daily deterministic "Heute" selection -->
<script>
(function(){
  const elJson = document.getElementById('allRecipesJson');
  if(!elJson) return;

  let recipes = [];
  try { recipes = JSON.parse(elJson.textContent || '[]'); } catch(e) { return; }
  if(!Array.isArray(recipes) || recipes.length === 0) return;

  const dayKey = new Date().toISOString().slice(0,10); // YYYY-MM-DD

  function hashString(s){
    let h = 2166136261; // FNV-1a
    for(let i=0;i<s.length;i++){
      h ^= s.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return (h >>> 0);
  }

  const idx = hashString(dayKey) % recipes.length;
  const r = recipes[idx];

  const link = document.getElementById('todayLink');
  const fav  = document.getElementById('todayFav');
  const imgW = document.getElementById('todayThumbWrap');
  const img  = document.getElementById('todayImg');
  const ttl  = document.getElementById('todayTitle');
  const cat  = document.getElementById('todayCat');
  const tEl  = document.getElementById('todayTime');
  const sEl  = document.getElementById('todayServings');

  if(link) link.href = r.url || r.id;

  if(fav){
    fav.dataset.recipeId = r.id;
  }

  if(ttl) ttl.textContent = r.title || "Rezept";

  if(cat){
    if(r.category){
      cat.style.display = "";
      cat.textContent = r.category;
    } else {
      cat.style.display = "none";
    }
  }

  if(tEl){
    if(r.time){
      tEl.style.display = "";
      tEl.textContent = "‚è± " + r.time;
    } else {
      tEl.style.display = "none";
    }
  }

  if(sEl){
    if(r.servings){
      sEl.style.display = "";
      sEl.textContent = "üçΩ " + r.servings;
    } else {
      sEl.style.display = "none";
    }
  }

  if(imgW && img){
    if(r.image){
      imgW.style.display = "";
      img.src = r.image;
      img.alt = r.title || "Rezept";
    } else {
      imgW.style.display = "none";
    }
  }
})();
</script>
